"use strict";(()=>{var e={};e.id=159,e.ids=[159],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6544:e=>{e.exports=import("node-fetch")},3465:(e,t,a)=>{a.a(e,async(e,i)=>{try{a.r(t),a.d(t,{config:()=>u,default:()=>l,routeModule:()=>c});var n=a(1802),o=a(7153),s=a(6249),r=a(2606),d=e([r]);r=(d.then?(await d)():d)[0];let l=(0,s.l)(r,"default"),u=(0,s.l)(r,"config"),c=new n.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/roundrobin",pathname:"/api/roundrobin",bundlePath:"",filename:""},userland:r});i()}catch(e){i(e)}})},2606:(e,t,a)=>{a.a(e,async(e,i)=>{try{a.r(t),a.d(t,{default:()=>handler});var n=a(6544),o=e([n]);n=(o.then?(await o)():o)[0];let s=process.env.ZENDESK_URL;async function handler(e,t){try{let a,i;let o=e.query.ticketid;console.log({query:e.query}),console.log({ticketId:e.query.ticketid}),console.log({authorization:e.headers.authorization});let r=await (0,n.default)(`${s}/api/v2/tickets/${o}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:e.headers.authorization}}),d=await r.json();console.log({ticketData:d});let l=await (0,n.default)(`${s}/api/v2/groups/${d.ticket.group_id}/users`,{method:"GET",headers:{Authorization:e.headers.authorization}}),u=await l.json();console.log({usersData:u});let c=u.users.sort((e,t)=>e.name<t.name?-1:e.name>t.name?1:void 0),h=c.filter(e=>!e.user_fields.agent_ooo);if(h.length>0){if(1===h.length)a=h[0],i=h[0];else if(a=h.find(e=>e.user_fields.assign_next)){let e=h.indexOf(a);i=e===h.length-1?h[0]:h[e+1]}else a=h[0],i=h[1];await (0,n.default)(`${s}/api/v2/tickets/${o}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:e.headers.authorization},body:JSON.stringify({ticket:{assignee_email:a.email,assignee_id:a.id}})}),await (0,n.default)(`${s}/api/v2/users/update_many`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:e.headers.authorization},body:JSON.stringify({users:[{id:a.id,user_fields:{assign_next:!1}},{id:i.id,user_fields:{assign_next:!0}}]})})}t.status(200).json({message:"Round robin executed on ticket "+o,currentAssignee:a?a.name:"NA",nextAssignee:i?i.name:""})}catch(e){console.log(e)}}i()}catch(e){i(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[222],()=>__webpack_exec__(3465));module.exports=a})();